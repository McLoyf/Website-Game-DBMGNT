<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tetris — Leaderboard</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
  <main class="card" role="main">
    <h1>Tetris — Leaderboard</h1>
    <p class="subtitle">Blank leaderboard table ready to be populated by your game (client-side or server-side).</p>

    <div class="controls">
      <button class="btn" disabled>Import</button>
      <button class="btn" disabled>Export</button>
    </div>

    <table aria-label="Tetris leaderboard table">
      <thead>
        <tr>
          <th class="rank">Rank</th>
          <th>Player</th>
          <th class="score">Score</th>
          <th>Level</th>
          <th class="meta">Lines</th>
          <th class="meta">Date</th>
        </tr>
      </thead>
      <tbody id="leaderboard-body">
        <!-- Empty by design. Use JavaScript to insert rows. -->
      </tbody>
    </table>

    <p class="small" style="margin-top:14px">Tip: call <code>populateLeaderboard(arrayOfEntries)</code> from your game when a high score is ready to show.</p>
  </main>

  <script>
    /* Example JS helper: call populateLeaderboard([{player:'Alice',score:12345,level:10,lines:123,date:'2025-10-28'}]) */
    function createRow(rank, entry){
      const tr = document.createElement('tr');
      const rankTd = document.createElement('td'); rankTd.className = 'rank'; rankTd.textContent = rank;
      const nameTd = document.createElement('td'); nameTd.textContent = entry.player || '—';
      const scoreTd = document.createElement('td'); scoreTd.className = 'score'; scoreTd.textContent = entry.score != null ? entry.score : '—';
      const levelTd = document.createElement('td'); levelTd.textContent = entry.level != null ? entry.level : '—';
      const linesTd = document.createElement('td'); linesTd.className = 'meta'; linesTd.textContent = entry.lines != null ? entry.lines : '—';
      const dateTd = document.createElement('td'); dateTd.className = 'meta'; dateTd.textContent = entry.date || '—';
      tr.append(rankTd, nameTd, scoreTd, levelTd, linesTd, dateTd);
      return tr;
    }

    function clearLeaderboard(){
      const body = document.getElementById('leaderboard-body');
      body.innerHTML = '';
    }

    function populateLeaderboard(entries){
      // entries: array sorted by desired order (best first)
      const body = document.getElementById('leaderboard-body');
      clearLeaderboard();
      if(!entries || entries.length === 0){
        const tr = document.createElement('tr'); tr.className = 'empty';
        const td = document.createElement('td'); td.colSpan = 6; td.textContent = 'No high scores yet — play a game to create one!';
        tr.appendChild(td); body.appendChild(tr); return;
      }
      entries.forEach((e,i)=> body.appendChild(createRow(i+1, e)));
    }

    // Expose helper to window for easy testing in dev console
    window.populateLeaderboard = populateLeaderboard;

    // Uncomment to test sample data on load:
    // populateLeaderboard([{player:'Player1',score:99999,level:20,lines:400,date:'2025-10-28'}]);
  </script>
  <script>
  async function loadLeaderboard() {
    try {
      const res = await fetch("https://website-game-dbmgnt-production.up.railway.app/api/scores");
      const data = await res.json();

      // Transform backend data into leaderboard-friendly format
      const entries = data.map((row, index) => ({
        player: row.Username || "—",
        score: row.FinalScore || 0,
        level: "—", // placeholder, unless you add level to DB
        lines: "—", // placeholder
        date: new Date(row.DatePlayed).toLocaleDateString(),
      }));

      populateLeaderboard(entries);
    } catch (err) {
      console.error("Error loading leaderboard:", err);
      populateLeaderboard([]);
    }
  }

  // Load leaderboard automatically on page load
  window.addEventListener("DOMContentLoaded", loadLeaderboard);
</script>

    <div class="bottom-link">
        <a href="../index.html">Go Back to Home</a>
    </div>
</body>
</html>
